import os
import subprocess as sb
import serial

port = serial.Serial(
            port='COM5',
            baudrate=9600,
            parity=serial.PARITY_ODD,
            stopbits=serial.STOPBITS_TWO,
            bytesize=serial.SEVENBITS)

bandwidths = range(50, 500, 50)+range(500, 1000, 100)+range(1000, 10001, 1000)
command = "iperf.exe"

for bandwidth in bandwidths:
    port.write("mls qos aggregate-policer aggpolicer " + str(bandwidth) + " 8000 exceed-action drop\n")
    
    for client in range(1, 10):
        process = sb.Popen([command, " -c12.0.0.2", " -t10", " -P" + str(client)], stdout=sb.PIPE)
        out, err = process.communicate()
        summary = out.split("\n")[-1]
        print out